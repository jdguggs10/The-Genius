# Tailwind v4.1 Safelist Configuration Guide

## Overview

This project uses Tailwind v4.1's safelist functionality to preserve dynamically generated classes in production builds. The safelist prevents important CSS classes from being purged when they're generated by AI responses, user interactions, or computed at runtime.

## How It Works

Tailwind v4.1's Oxide engine scans the `src/tailwind.safelist` file during build time and ensures that any classes matching the regex patterns are included in the final CSS, even if they're not found in the source code during static analysis.

## Files

- `src/tailwind.safelist` - Contains regex patterns for dynamic classes
- `package.json` - Updated build scripts with safelist support

## Build Scripts

### Standard Build (without safelist)
```bash
npm run build
```

### Build with Safelist (recommended for production)
```bash
npm run build:safelist
```

### Utility Scripts
```bash
# Export current design tokens to JSON
npm run tailwind:tokens

# Test safelist patterns without building
npm run tailwind:safelist-check
```

## Safelist Categories

### 1. Dynamic Color Classes
Handles AI-generated content that might reference arbitrary colors:
```css
text-[#ff0000]
bg-[rgb(255,0,0)]
text-[oklch(0.7 0.15 180)]
bg-[color-mix(in srgb, #ff0000 50%, #0000ff)]
```

### 2. Dynamic Spacing & Sizing
Computed dimensions based on container size or content:
```css
w-[384px]
h-[48rem]
max-w-[90%]
grid-cols-[1fr_2fr_1fr]
```

### 3. Tailwind v4.1 Specific Features
New utilities introduced in v4.1:
```css
text-shadow-[0_2px_4px_rgba(0,0,0,0.1)]
mask-radial-[circle_at_center]
text-shadow-black/10
```

### 4. Chat-Specific Classes
Classes specific to chat interface functionality:
```css
chat-bubble-primary
message-incoming
bubble-ai
avatar-[40px]
```

### 5. AI Response Formatting
Classes for AI-generated content styling:
```css
prose-ai
code-highlight
syntax-javascript
markdown-table
```

## Adding New Patterns

To add new safelist patterns, edit `src/tailwind.safelist`:

```bash
# Example: Add support for dynamic border radius
border-radius-\[\d+(\.\d+)?(px|rem|%)\]

# Example: Add support for custom animations
animate-custom-\w+
```

## Common Use Cases

### AI-Generated Colors
When AI responses include color recommendations:
```tsx
// AI might generate: "Use a blue color: text-[#3b82f6]"
<div className="text-[#3b82f6]">AI generated color</div>
```

### Dynamic Sizing
When container queries adjust sizing:
```tsx
// Container query might compute: w-[320px] for tablet view
<input className="w-[320px] composer-input" />
```

### Theme Switching
When themes apply arbitrary color values:
```tsx
// Theme might use: bg-[oklch(94% .17 245)]
<div className="bg-[oklch(94% .17 245)]">Themed background</div>
```

### Animation States
When interactions trigger computed animations:
```tsx
// State might apply: animate-[fadeIn_0.3s_ease-in-out]
<div className="animate-[fadeIn_0.3s_ease-in-out]">Animated content</div>
```

## Performance Considerations

### File Size Impact
- Safelist patterns increase CSS bundle size
- Only include necessary patterns
- Use specific regex to avoid over-matching

### Build Time
- Safelist scanning adds ~50-100ms to build time
- Negligible impact compared to bundle benefits
- Use `npm run tailwind:safelist-check` to test patterns

## Best Practices

### 1. Specific Patterns
```bash
# Good: Specific color pattern
text-\[#[0-9a-fA-F]{6}\]

# Avoid: Overly broad pattern
text-\[.+\]
```

### 2. Documentation
Always document why patterns are needed:
```bash
# AI color recommendations for fantasy sports teams
text-\[#[0-9a-fA-F]{6}\]
bg-\[#[0-9a-fA-F]{6}\]
```

### 3. Regular Cleanup
Periodically review and remove unused patterns:
```bash
# Run safelist check to verify patterns are still needed
npm run tailwind:safelist-check
```

### 4. Environment-Specific Usage
Consider different safelist needs for different environments:
```bash
# Development: Include debug classes
debug-\w+

# Production: Focus on user-facing classes
text-\[#[0-9a-fA-F]{6}\]
```

## Troubleshooting

### Classes Still Being Purged
1. Check pattern syntax in `src/tailwind.safelist`
2. Verify build script uses `--safelist` flag
3. Test pattern with `npm run tailwind:safelist-check`

### Bundle Size Too Large
1. Review safelist patterns for over-matching
2. Use more specific regex patterns
3. Remove unused patterns

### Build Errors
1. Ensure Tailwind v4.1+ is installed
2. Check safelist file syntax
3. Verify Vite configuration supports safelist flag

## Examples in This Project

### Container Query Classes
```css
# For responsive composer layout
composer-input-\w+
chat-container-\w+
```

### AI Response Classes
```css
# For dynamic AI content styling
prose-ai-\w+
bubble-ai-\w+
```

### Theme-Aware Classes
```css
# For runtime theme switching
theme-\w+
dark:\w+-\w+
```

## Migration from v3

If migrating from Tailwind v3:

1. Replace old `purge.safelist` configuration
2. Move patterns to `src/tailwind.safelist`
3. Update build scripts to use `--safelist` flag
4. Test all dynamic class generation

## Further Reading

- [Tailwind v4.1 Documentation](https://tailwindcss.com/docs)
- [Oxide Engine Performance](https://tailwindcss.com/blog/tailwindcss-v4-alpha)
- [Container Queries Guide](https://tailwindcss.com/docs/container-queries)
- [Design Tokens Best Practices](https://tailwindcss.com/docs/customizing-colors) 