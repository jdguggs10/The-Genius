# The Genius - Fantasy Sports AI Web App

> **The Face of Your AI Assistant** - A modern, clean chat interface where users get expert fantasy sports advice

This is the frontend web application that users interact with. It provides a beautiful, mobile-friendly chat interface where people can ask fantasy sports questions and get intelligent AI responses. Think of it as the "face" of your AI assistant that makes everything user-friendly.

## üåü What This Does

This web app provides:
- **Clean Chat Interface**: Simple, WhatsApp-style messaging.
- **Smart AI Responses**: Connects to your backend API for AI-powered advice.
- **Real-time Streaming**: Message responses are streamed via WebSockets for a fluid, real-time experience.
- **Enhanced UX & Performance**:
    - **Virtualized Message List**: Smooth scrolling and high performance even with very long conversations, thanks to `react-window`.
    - **Skeleton Loaders**: Placeholder UI elements appear instantly while messages are being generated by the AI, improving perceived performance.
    - **Improved Scroll Behavior**: Includes a "New messages" chip to easily navigate to the latest messages when scrolled up.
    - **Message Actions**: Conveniently copy message content with a single click.
    - **User & AI Avatars**: Clear visual distinction between user and AI messages using icons.
- **Theming**:
    - **Dark Mode**: User-selectable light, dark, and system-preference themes.
- **Accessibility (A11y)**:
    - Improved for screen readers with `role="log"` for message areas and dynamic ARIA labels for messages.
    - Input field automatically focuses on page load.
    - Respects user's OS preference for reduced motion, minimizing animations where appropriate.
- **PWA Capabilities**: Installable as a Progressive Web App for an app-like experience, with offline asset caching.
- **Robust Error Handling**: Features an Error Boundary for UI issues and toast notifications for operational errors (e.g., connection problems).
- **Web Search Detection**: Automatically enables web search when users ask for current stats.
- **Mobile Friendly**: Works perfectly on phones, tablets, and computers.
- **Daily Usage Limits**: Free users get 5 messages per day (encourages premium upgrades).

## üéØ Who Uses This

- **Fantasy Sports Players**: People who want quick advice on lineups, trades, pickups
- **Casual Fans**: Users who need help understanding complex fantasy decisions  
- **Mobile Users**: Anyone who prefers a simple chat interface over complex apps
- **Your Website Visitors**: The main way people interact with your AI assistant

## üîß Technology Stack (What's Under the Hood)

### Core Technologies
- **React 19**: Latest version of the most popular web framework.
- **TypeScript**: Adds type safety to prevent bugs and improve development.
- **Vite**: Super fast build tool that makes development smooth and quick.
- **pnpm**: Fast, disk space efficient package manager.

### Styling & UI
- **Tailwind CSS**: Utility-first CSS framework for consistent, beautiful styling.
- **Heroicons**: Clean, professional icons used throughout the application.
- **Framer Motion**: Smooth animations for message appearance and UI elements, with support for reduced motion.

### Key Features & Libraries
- **WebSocket Streaming**: Real-time message delivery (`useChatSocket` custom hook).
- **Virtualized Lists**: Efficient rendering of long message lists using `react-window`.
- **Toast Notifications**: User-friendly error and success messages via `react-hot-toast`.
- **PWA Support**: Progressive Web App capabilities enabled by `@vite-pwa/plugin`.
- **React Markdown**: Converts AI responses with formatting into nice, readable display.
- **Custom Hooks**: For managing theme (`useTheme`), scroll behavior (`useScrollAnchor`), and WebSocket connection (`useChatSocket`).
- **Daily Quota System**: Tracks message limits using browser's local storage (`useDailyQuota`).
- **Responsive Design**: Automatically adapts to any screen size.

## üìÅ Project Structure

```
web-app/
‚îú‚îÄ‚îÄ public/                      # Static files (icons, PWA manifest assets, etc.)
‚îÇ   ‚îî‚îÄ‚îÄ icons/                   # PWA related icons
‚îú‚îÄ‚îÄ src/                           # All the source code
‚îÇ   ‚îú‚îÄ‚îÄ components/               # Reusable UI pieces
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.tsx             # Main chat interface
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message.tsx          # Individual chat message bubbles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SkeletonMessage.tsx  # Loading placeholder for messages
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatErrorBoundary.tsx # Catches React rendering errors
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ QuotaModal.tsx       # Daily limit popup modal (if still used)
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                   # Custom React logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useChatSocket.ts     # Manages WebSocket connection and streaming
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useDailyQuota.ts     # Manages 5-message daily limit
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useScrollAnchor.ts   # Advanced scroll management for chat
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useTheme.ts          # Handles theme (light/dark/system)
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx                  # Main app component
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx                 # App entry point (initializes React, Toaster, Error Boundary)
‚îÇ   ‚îú‚îÄ‚îÄ types/index.ts           # TypeScript type definitions (including SSEEventData for WS)
‚îÇ   ‚îî‚îÄ‚îÄ index.css                # Global styles, Tailwind imports, dark mode base styles
‚îú‚îÄ‚îÄ package.json                 # Lists all dependencies and scripts
‚îú‚îÄ‚îÄ vite.config.ts               # Vite configuration (including VitePWA plugin)
‚îú‚îÄ‚îÄ tailwind.config.js           # Tailwind CSS configuration (darkMode: 'class' enabled)
‚îú‚îÄ‚îÄ render.yaml                  # Deployment configuration for Render.com
‚îî‚îÄ‚îÄ README.md                    # This detailed guide
```

## üöÄ Quick Start Guide

### Step 1: Get Your Environment Ready

**Install Node.js** (if you don't have it):
1. Go to [nodejs.org](https://nodejs.org)
2. Download the "LTS" version (recommended for most users)
3. Install it (follow the installer instructions)
4. Open a terminal/command prompt and verify:
   ```bash
   node --version  # Should show v18 or higher
   npm --version   # Should show 8 or higher
   ```

**Install pnpm** (recommended for this project for faster and more efficient package management):
Unless you have a specific reason to use npm or Yarn, using pnpm is advised.
```bash
# Install pnpm globally using npm (if you haven't already)
npm install -g pnpm

# Verify it works
pnpm --version  # Should show a version number
```
Alternatively, if you are using Node.js version 16.9 or later, you can enable Corepack, which is a built-in Node.js tool to manage package managers:
```bash
corepack enable
corepack prepare pnpm@latest --activate
pnpm --version
```

### Step 2: Get the Code and Install Dependencies

```bash
# 1. Navigate to the web-app folder
cd web-app

# 2. Install all required packages (this takes a few minutes the first time)
pnpm install

# You should see it download lots of packages - this is normal!
# If you encounter issues, ensure your Node.js and pnpm versions are up to date.
```

### Step 3: Configure the Backend Connection
The web app now primarily uses WebSockets for real-time communication.
1.  **Create an environment file**:
    In the `web-app` directory, create a new file named `.env`. You can copy `.env.example` if it exists.
    ```bash
    cp .env.example .env # If .env.example exists
    ```
2.  **Edit the `.env` file**:
    Open `.env` and set `VITE_BACKEND_URL` for initial HTTP calls (like fetching default model) and `VITE_BACKEND_WS_URL` for the WebSocket connection.
    *   **`VITE_BACKEND_URL`**: e.g., `http://localhost:8000` or `https://your-backend-url.com` (no `/advice` path here, it's added in code for specific calls).
    *   **`VITE_BACKEND_WS_URL`**: e.g., `ws://localhost:8000/chat` or `wss://your-backend-url.com/chat`.

    If these are not set, the app will attempt to derive them from a default base URL (e.g. `http://localhost:8000` or `https://genius-backend-nhl3.onrender.com`), constructing both HTTP and WebSocket URLs. Explicitly setting them is recommended.

Example `web-app/.env`:
```env
VITE_BACKEND_URL=https://your-backend-http-url.com
VITE_BACKEND_WS_URL=wss://your-backend-ws-url.com/chat
```

### Step 4: Start the Development Server

```bash
# Start the development server
pnpm run dev

# You should see output like:
# VITE v5.x.x ready in xxx ms
# ‚ûú Local:   http://localhost:5173/
# ‚ûú Network: use --host to expose
```

### Step 5: Test Everything Works

1. **Open your browser** and go to: `http://localhost:5173`
2. **Should see**: "The Genius" header and chat interface
3. **Test the chat**: Type "Hello" and press Enter or click send
4. **Should get**: An AI response (if your backend is working)
5. **Check daily counter**: Should show "1 of 5 messages used today"

## üé® Features Deep Dive

### Chat Interface (`src/components/chat.tsx`)
**What it does**:
- Handles all user interactions (typing, sending messages).
- Connects to your backend API via WebSockets for real-time, streaming AI responses (`useChatSocket`).
- Manages conversation history and display using a virtualized list (`FixedSizeList` from `react-window`) for optimal performance.
- Implements theme switching (light/dark/system) via `useTheme` hook and toggle button.
- Shows skeleton loaders (`SkeletonMessage`) while waiting for AI responses.
- Implements enhanced scrolling with "New messages" chip and programmatic scroll control (`useScrollAnchor`).
- Controls daily message limits.

**Key features**:
- **Real-time Streaming**: Messages stream in character by character via WebSockets.
- **Virtualized Scrolling**: Handles thousands of messages smoothly.
- **Message Actions**: Copy message text. (Edit/Delete are UI stubs).
- **Visual Feedback**: Skeleton loaders, loading spinners on send button, toast notifications for errors/success.
- **Error handling**: Gracefully handles WebSocket connection issues with retries and user notifications. Shows UI error boundary for critical rendering errors.
- **Smart web search**: Automatically enables web search for questions that include keywords like "stats", "current", "latest", "today", "who plays", or if the message is prefixed with "search:".

**Message flow (WebSocket)**:
```
User types message ‚Üí Press Enter ‚Üí Web app establishes WebSocket connection (if not already connected) ‚Üí Sends request payload (conversation, flags) over WebSocket ‚Üí Backend processes, streams back events (status_update, text_delta, response_complete, error) ‚Üí UI updates dynamically based on received events.
```

### Daily Quota System (`src/hooks/useDailyQuota.ts`)

**How it works**:
1. **Tracks daily usage**: Stores count in browser's localStorage
2. **Resets automatically**: Counter resets at midnight each day
3. **Enforces limits**: Blocks new messages after 5 per day
4. **Shows modal**: Encourages users to get the mobile app for unlimited access

**Storage format**:
```javascript
// In browser localStorage:
"quota-2024-03-15": "3"  // Used 3 messages on March 15, 2024
```

### Message Components (`src/components/message.tsx`)

**User messages**: 
- Blue bubbles on the right, with `UserIcon` avatar.
- Actions bar on hover (Copy, Edit stub, Delete stub).
**AI responses**:
- Theme-aware bubbles on the left (e.g., dark gray in dark mode), with `SparklesIcon` (AI) avatar.
- Supports Markdown formatting.
- Actions bar on hover (Copy).
- Animated appearance respecting reduced motion preferences.

### Skeleton Message (`src/components/SkeletonMessage.tsx`)
- Appears immediately when AI response is expected.
- Provides a visual placeholder matching message structure.
- Uses subtle pulse animation (disabled if reduced motion is preferred).

### Error Handling & Notifications
- **`ChatErrorBoundary.tsx`**: A React Error Boundary wrapping the main application in `main.tsx`. Catches JavaScript errors during rendering and displays a fallback UI.
- **`react-hot-toast`**: Used for non-critical notifications:
    - WebSocket connection errors/status.
    - AI-generated errors from the backend.
    - Success/failure of copying message text.
    - Configured in `main.tsx` with default styling and specific styles for error toasts.

### Theming (`src/hooks/useTheme.ts`)
- Supports light, dark, and system themes.
- Selected theme is persisted in `localStorage`.
- Applies `.dark` class to `<html>` element.
- Listens to OS-level theme changes when 'system' theme is active.
- Most UI components now have `dark:` variants in their Tailwind CSS classes.

### Progressive Web App (PWA)
- Configured using `@vite-pwa/plugin` in `vite.config.ts`.
- Includes a web app manifest (`manifest.webmanifest` generated by the plugin).
- Service worker for caching app shell assets (`globPatterns`) and basic runtime caching for fonts and API GET requests (NetworkFirst).
- App can be installed on compatible devices for an app-like experience.

### Quota Modal (`src/components/QuotaModal.tsx`)

**When it appears**: After user hits 5 message limit
**What it shows**: 
- "Daily Limit Reached" message
- Explanation of the 5-message limit
- Encouragement to download mobile app
- Close button to dismiss

## üõ† Development Guide

### Available Commands

```bash
# Development (with hot reload - changes appear instantly)
pnpm run dev

# Build for production (creates optimized files)
pnpm run build

# Preview production build locally (test before deploying)
pnpm run preview

# Check code for issues (find potential problems)
pnpm run lint
```

### Making Changes

**To modify the chat interface**:
1. Open `src/components/chat.tsx` in your text editor
2. Make your changes (add features, change styling, etc.)
3. Save the file
4. Changes appear instantly in your browser (hot reload)

**To change colors/styling**:
1. **Global changes**: Edit `src/index.css`
2. **Component styling**: Look for `className=` in component files
3. **Tailwind classes**: Use classes like `bg-blue-500`, `text-white`, etc.

**To modify daily limits**:
1. Open `src/hooks/useDailyQuota.ts`
2. Change `MAX_DAILY_MESSAGES = 5` to your desired number
3. Save and test

### Adding New Features

**Example: Add a "Clear Chat" button**

1. **Add to chat component** (`src/components/chat.tsx`):
```typescript
// Add this function inside the Chat component:
const clearChat = () => {
  setMessages([]);
};

// Add this button in the JSX (around line 140):
<button 
  onClick={clearChat}
  className="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm"
>
  Clear Chat
</button>
```

2. **Test it works**: Click the button, chat should clear

3. **Style it nicely**: Adjust the Tailwind classes as needed

### Working with the Backend

**API call structure** (in `src/components/chat.tsx`):
```typescript
const response = await fetch('your-backend-url/advice', {
  method: 'POST',
  headers: { 
    'Content-Type': 'application/json',
    'Accept': 'application/json'
  },
  body: JSON.stringify({ 
    conversation: [{ role: 'user', content: 'user question' }],
    enable_web_search: false  // or true for current stats
  })
});
```

**Expected response format**:
```json
{
  "reply": "AI's response text",
  "model": "gpt-4.1"
}
```

### Error Handling

The app handles these error scenarios:
- **Network errors**: "Unable to connect to AI service"
- **Backend errors**: Shows specific error message from server
- **Invalid responses**: "Invalid response format from backend"
- **Quota exceeded**: Shows quota modal instead of sending request

## üåê Deployment Guide

### Deploy to Render.com (Recommended - Easy)

**Step 1: Prepare Your Code**
1. Make sure your code is saved and pushed to GitHub
2. Test locally to ensure everything works
3. Verify `render.yaml` exists in your web-app folder

**Step 2: Set Up Render**
1. Go to [render.com](https://render.com) and create account
2. Click "New" ‚Üí "Static Site"
3. Connect your GitHub repository
4. Select your repository from the list

**Step 3: Configure the Service**
- **Name**: `genius-frontend` (or whatever you prefer)
- **Branch**: `main` (or your main branch)
- **Root Directory**: `web-app` (important!)
- **Build Command**: `pnpm install && pnpm run build`
- **Publish Directory**: `dist`

**Step 4: Configure Backend Routing**
Render will automatically read your `render.yaml` file which includes:
```yaml
routes:
  - type: rewrite
    source: /api/*
    destination: https://genius-backend-nhl3.onrender.com/:splat
```

This makes sure API calls from your frontend reach your backend.

**Step 5: Deploy**
1. Click "Create Static Site"
2. Wait for deployment (takes 3-5 minutes)
3. Test your deployed site at the provided URL
4. Future updates deploy automatically when you push to GitHub

### Deploy to Netlify (Alternative)

1. **Connect repository**: Link your GitHub repo
2. **Set build settings**:
   - Build command: `cd web-app && npm install && npm run build`
   - Publish directory: `web-app/dist`
3. **Add redirect rules** in `web-app/public/_redirects`:
   ```
   /api/* https://your-backend-url.com/:splat 200
   /* /index.html 200
   ```

### Deploy to Vercel (Alternative)

1. **Connect repository**: Import from GitHub
2. **Configure project**:
   - Framework preset: Vite
   - Root directory: `web-app`
   - Build command: `pnpm run build`
   - Output directory: `dist`
3. **Add environment variables** if needed

### Manual Deployment

**Build the production version**:
```bash
# From the web-app folder
pnpm run build

# Creates a 'dist' folder with optimized files
# Upload contents of 'dist' folder to any web hosting:
# - AWS S3 + CloudFront
# - Google Cloud Storage
# - Any web hosting service
```

## üé® Customization Guide

### Changing Colors and Appearance

**Main color scheme** (in `src/components/chat.tsx`):
```typescript
// User messages (currently blue):
className="bg-blue-500 text-white"  // Change blue-500 to any color

// AI messages (currently gray):
className="bg-gray-100 text-gray-800"  // Change colors as desired

// Send button:
className="bg-blue-500 hover:bg-blue-600"  // Change blue to any color
```

**Available Tailwind colors**:
- `red-500`, `green-500`, `yellow-500`, `purple-500`, `pink-500`
- `indigo-500`, `cyan-500`, `teal-500`, `lime-500`, `orange-500`
- Numbers: 100 (lightest) to 900 (darkest)

### Changing Text and Messages

**App title** (in `src/App.tsx`):
```typescript
<h1>The Genius</h1>  // Change to your preferred title
```

**Chat placeholder examples** (in `src/components/chat.tsx`):
```typescript
// Around line 85, change these examples:
<li>"Should I start Patrick Mahomes or Josh Allen this week?"</li>
<li>"Who are the top sleeper picks for fantasy baseball?"</li>
<li>"Is Christian McCaffrey worth trading for?"</li>
```

**Quota modal text** (in `src/components/QuotaModal.tsx`):
```typescript
<h2>Daily Limit Reached</h2>  // Change title
<p>You've reached your 5 message daily limit...</p>  // Change description
```

### Changing Daily Limits

**Modify the limit** (in `src/hooks/useDailyQuota.ts`):
```typescript
const MAX_DAILY_MESSAGES = 5;  // Change 5 to any number you want
```

**Disable limits completely**:
1. In `src/components/chat.tsx`, find this line:
   ```typescript
   if (!input.trim() || isLoading || isLimitReached) return;
   ```
2. Change to:
   ```typescript
   if (!input.trim() || isLoading) return;  // Remove isLimitReached
   ```
3. Hide the quota counter by removing this section:
   ```typescript
   <div className="text-center text-sm text-gray-500 mt-2">
     {count} of {5} messages used today
   </div>
   ```

### Adding Your Own Branding

**Logo/Image** (add to `public/` folder):
```typescript
// In src/App.tsx:
<img src="/your-logo.png" alt="Your Logo" className="h-12 w-auto" />
```

**Custom CSS** (in `src/index.css`):
```css
/* Add custom styles at the end */
.your-custom-class {
  background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
  color: white;
}
```

## üêõ Troubleshooting

### Common Issues

**"Node.js not found" or "Command not found"**
```bash
# Install Node.js from nodejs.org
# Then restart your terminal and try again
node --version  # Should show v18+
```

**"pnpm not found"**
```bash
# Install pnpm globally
npm install -g pnpm

# Or use npm instead of pnpm throughout this guide
npm install  # instead of: pnpm install
npm run dev  # instead of: pnpm run dev
```

**"Module not found" errors**
```bash
# Delete node_modules and reinstall
rm -rf node_modules
pnpm install

# On Windows:
rmdir /s node_modules
pnpm install
```

**Web app loads but can't connect to backend**
1. **Check the backend URL** in `src/components/chat.tsx`
2. **Verify backend is running** by visiting its health endpoint
3. **Look at browser console** (press F12 ‚Üí Console tab) for error messages
4. **Check CORS settings** in your backend

**Styling not working or looks wrong**
```bash
# Restart the development server  
# Press Ctrl+C to stop, then:
pnpm run dev
```

**Build fails**
```bash
# Check for TypeScript errors
pnpm run lint

# Fix any errors shown, then try building again
pnpm run build
```

### Debug Mode

**Enable verbose logging** (in `src/components/chat.tsx`):
```typescript
// Add more console.log statements:
console.log('Sending request:', { conversation: [userMessage] });
console.log('Response received:', response);
console.log('Parsed data:', data);
```

**Check browser developer tools**:
1. Press `F12` to open developer tools
2. **Console tab**: See JavaScript errors and log messages
3. **Network tab**: See API requests and responses
4. **Application tab**: Check localStorage for quota data

### Performance Issues

**Slow loading**:
- Check your internet connection
- Verify backend is responding quickly
- Consider using a CDN for static assets

**Memory issues**:
- Clear browser cache and cookies
- Restart browser
- Close other tabs/applications

## üìä Analytics & Monitoring

### User Behavior Tracking

**Basic usage analytics** (add to `src/components/chat.tsx`):
```typescript
// Track when users send messages
const handleSend = async () => {
  // ... existing code ...
  
  // Simple analytics tracking:
  console.log('Message sent:', {
    timestamp: new Date().toISOString(),
    messageLength: input.length,
    dailyCount: count + 1
  });
};
```

**Quota tracking**:
```typescript
// In useDailyQuota.ts, add tracking:
const increment = () => {
  const newCount = count + 1;
  localStorage.setItem(storageKey, String(newCount));
  setCount(newCount);
  
  // Track quota usage
  if (newCount === MAX_DAILY_MESSAGES) {
    console.log('User hit daily limit');
  }
};
```

### Performance Monitoring

**Measure response times**:
```typescript
// In chat.tsx, around the API call:
const startTime = Date.now();
const response = await fetch(/* ... */);
const responseTime = Date.now() - startTime;
console.log(`Backend response time: ${responseTime}ms`);
```

## ü§ñ AI Reviewer Notes
For AI agents reviewing this web application, the following points are key to understanding its architecture and core logic:

-   **`src/components/chat.tsx`**: Central component for UI, user input, conversation state. Now uses WebSockets (`useChatSocket`) for real-time streaming and `FixedSizeList` for message display. Manages theme toggle.
-   **`src/hooks/useChatSocket.ts`**: Manages WebSocket lifecycle, message sending/receiving, and reconnection logic. Crucial for understanding real-time communication.
-   **`src/hooks/useTheme.ts`**: Handles theme switching (light/dark/system) and persistence.
-   **`src/hooks/useScrollAnchor.ts`**: Manages complex scroll logic for the chat, especially with the virtualized list and "new message" chip.
-   **`src/hooks/useDailyQuota.ts`**: (If still active) Client-side daily message quota.
-   **PWA Configuration (`vite.config.ts` with `@vite-pwa/plugin`)**: Defines manifest, service worker strategies (app shell caching, basic runtime caching).
-   **Error Handling**: `ChatErrorBoundary.tsx` for React errors, `react-hot-toast` for operational/async errors (e.g., WebSocket issues).
-   **Backend Connection**: Primarily via WebSockets (`VITE_BACKEND_WS_URL`). Initial HTTP calls (e.g., for model name) might still use `VITE_BACKEND_URL`.
-   **State Management**: Primarily local component state (`useState`, `useRef`) and context from `useConversationManager`.
-   **Styling**: Tailwind CSS with `dark:` variants for theming.
-   **Virtualization**: `react-window` (`FixedSizeList`) in `chat.tsx` for rendering messages, with `Row` and `SkeletonMessage` as item renderers.
-   **Accessibility**: Includes ARIA attributes, focus management, and reduced motion considerations.